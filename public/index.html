<!DOCTYPE html>
<html lang="en-US" <head>
<!--Import Google Icon Font-->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<!--Import materialize.css-->
<link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<!--Let browser know website is optimized for mobile-->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="css/demo.css">
<script src="build/tracking-min.js"></script>
<script src="build/data/face-min.js"></script>
<style type="text/css">
	#my_camera_holder {
	  margin: 0 auto;
	}

	.curve_me {
	  border-radius: 6px;
	  overflow: hidden;
	}

	#video {
	  width:100%;
	  /* height:300px; */
	}

	#canvas {
		width:400px;
		height:300px;
	}

</style>
<title>FaceRecognition</title>
</head>

<body>
	<header>
		<div class="navbar-fixed">
			<nav>
				<div class="nav-wrapper deep-purple darken-4">
					<a href="#" class="brand-logo">Logo</a>
					<ul id="nav-mobile" class="right hide-on-med-and-down">
						<li>
							<a href="">NavItem1</a>
						</li>
						<li>
							<a href="">NavItem1</a>
						</li>
						<li>
							<a href="">NavItem1</a>
						</li>
					</ul>
				</div>
			</nav>
		</div>
	</header>
	<div class="container" style="margin-top: 8px">
		<div class="row">
			<div class="col s12 z-depth-2 deep-purple lighten-5">
				<div class="col s12">
					<video class="curve_me" id="video" preload autoplay loop muted></video>
					<canvas hidden id="canvas" width="640" height="480"></canvas>

				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript" src="js/socket.io.js"></script>
	<script>



	</script>

	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
	<script type="text/javascript" src="js/jquery.js"></script>

	<!-- <script type="text/javascript" src="js/webcam.min.js"></script> -->


	<script type="text/javascript" src="js/index.js"></script>
	<!--JavaScript at end of body for optimized loading-->
	<script type="text/javascript" src="js/materialize.min.js"></script>
	<script language="JavaScript">
		var loading = false;
		var socket = io('http://172.16.17.98:7190/');
		socket.on('connect', function(data){
			console.log("Connected");
			// console.log(data);
			// M.toast({ html: "Connected to the image server", displayLength: 1000 });
		});

		socket.on('disconnect', function(){
			console.log("Disconnected");
		});
		
		socket.on('completed', function(){
			loading = false;
		});
		window.onload = function () {
			var video = document.getElementById('video');
			var tracker = new tracking.ObjectTracker('face');
			tracker.setInitialScale(4);
			tracker.setStepSize(2);
			tracker.setEdgesDensity(0.1);

			tracking.track('#video', tracker, {
				camera: true
			});

			tracker.on('track', function (event) {
				if(loading) return;
				event.data.forEach(function (rect) {
					M.toast({ html: "Face detected please wait", displayLength: 1000 });
					//draw image to canvas. scale to target dimensions
					
					var canvas = document.getElementById('canvas');
					var ctx = canvas.getContext('2d');

					ctx.drawImage(video, 0, 0);
					var dataURI = canvas.toDataURL('image/jpeg');
					
					loading = true;
					socket.emit('on-data', dataURI );

					// send_image(dataURI);
				});
			});
		};


		function send_image(raw_image_data) {
			loading = true;
			$.ajax({
				url: "/process-image",
				type: "post",
				data: { image: raw_image_data },
				success: function(result) {
					M.toast("Welcome Dope");					
				}
				
			}).done(function() {
				loading = true;
			});

		}
	        

	</script>
</body>

</html>